<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataCraft Studio - By Ambuj Kumar Tripathi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: #000000;
            background-image: 
                radial-gradient(circle at 25% 25%, #1a1a2e 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #16213e 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, #0f0f23 0%, transparent 50%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Netflix-style animated mesh background */
        .mesh-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 20, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 20, 120, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(20, 255, 120, 0.02) 0%, transparent 50%),
                linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
        }

        /* Floating orbs like Spotify */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.4;
            animation: orbFloat 20s infinite ease-in-out;
        }

        .orb-1 {
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            top: 60%;
            right: 10%;
            animation-delay: 7s;
        }

        .orb-3 {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #a8e6cf, #7fcdcd);
            bottom: 20%;
            left: 30%;
            animation-delay: 14s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            25% { transform: translate(30px, -30px) rotate(90deg) scale(1.1); }
            50% { transform: translate(-20px, 20px) rotate(180deg) scale(0.9); }
            75% { transform: translate(20px, -10px) rotate(270deg) scale(1.05); }
        }

        /* Premium glassmorphism - Netflix style */
        .premium-glass {
            background: rgba(12, 12, 12, 0.85);
            backdrop-filter: blur(30px) saturate(1.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .card-glass {
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(20px) saturate(1.2);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 
                0 20px 40px -15px rgba(0, 0, 0, 0.7),
                0 0 0 1px rgba(255, 255, 255, 0.03),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        /* Spotify-style gradient text */
        .premium-gradient {
            background: linear-gradient(135deg, 
                #ff6b6b 0%, 
                #ee5a52 25%, 
                #ff9500 50%, 
                #ffd23f 75%, 
                #4ecdc4 100%);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientFlow 6s ease-in-out infinite;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Netflix-style button */
        .premium-btn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #e50914 0%, #f40612 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform: perspective(1px) translateZ(0);
        }

        .premium-btn:hover {
            background: linear-gradient(135deg, #f40612 0%, #e50914 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 25px 50px rgba(229, 9, 20, 0.4);
        }

        .premium-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .premium-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .premium-btn:hover::before {
            left: 100%;
        }

        /* Spotify-style secondary button */
        .secondary-btn {
            background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .secondary-btn:hover {
            background: linear-gradient(135deg, #1ed760 0%, #1db954 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 25px 50px rgba(29, 185, 84, 0.4);
        }

        /* Square profile image with premium styling */
        .profile-square {
            width: 120px;
            height: 120px;
            border-radius: 16px;
            object-fit: cover;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4) padding-box,
                        linear-gradient(135deg, #ff6b6b, #4ecdc4) border-box;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .profile-square:hover {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 
                0 30px 60px rgba(255, 107, 107, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        /* Premium status indicator */
        .status-indicator {
            position: absolute;
            bottom: -4px;
            right: -4px;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #1db954, #1ed760);
            border: 3px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Netflix-style loading */
        .netflix-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: #e50914;
            animation: netflixSpin 0.8s linear infinite;
        }

        @keyframes netflixSpin {
            to { transform: rotate(360deg); }
        }

        /* Premium upload zone */
        .upload-premium {
            background: linear-gradient(135deg, rgba(24, 24, 24, 0.9) 0%, rgba(18, 18, 18, 0.9) 100%);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .upload-premium:hover {
            border-color: #e50914;
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.05) 0%, rgba(244, 6, 18, 0.05) 100%);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(229, 9, 20, 0.1);
        }

        .upload-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(229, 9, 20, 0.1), transparent);
            transition: left 0.6s;
        }

        .upload-premium:hover::before {
            left: 100%;
        }

        /* Premium form elements */
        .premium-select {
            background: rgba(18, 18, 18, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .premium-select:focus {
            border-color: #e50914;
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.1);
            outline: none;
        }

        /* Chart container with premium styling */
        .chart-premium {
            background: linear-gradient(135deg, rgba(12, 12, 12, 0.95) 0%, rgba(8, 8, 8, 0.95) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Premium scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #e50914, #f40612);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #f40612, #e50914);
        }

        /* Entrance animations */
        .slide-up {
            animation: slideUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Premium typography */
        .title-premium {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        .subtitle-premium {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .code-font {
            font-family: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
        }

        /* Mobile responsive improvements */
        @media (max-width: 768px) {
            .orb { display: none; }
            
            .profile-square {
                width: 100px;
                height: 100px;
            }
        }

        /* Premium file input styling */
        .file-input-premium {
            color: transparent;
        }

        .file-input-premium::-webkit-file-upload-button {
            visibility: hidden;
        }

        .file-input-premium::before {
            content: 'Choose File';
            display: inline-block;
            background: linear-gradient(135deg, #e50914 0%, #f40612 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            outline: none;
            white-space: nowrap;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .file-input-premium:hover::before {
            background: linear-gradient(135deg, #f40612 0%, #e50914 100%);
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(229, 9, 20, 0.3);
        }
    </style>
</head>
<body class="text-white min-h-screen relative">
    
    <!-- Premium animated background -->
    <div class="mesh-bg"></div>
    
    <!-- Floating orbs -->
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <!-- Main Content -->
    <div class="relative z-10 min-h-screen flex flex-col items-center p-4 lg:p-8">
        
        <!-- Header Section with Premium Profile -->
        <div class="text-center mb-12 slide-up">
            <div class="flex flex-col items-center space-y-8">
                <!-- Premium Profile Image -->
                <div class="relative">
                    <img src="https://i.postimg.cc/zvjwpbJf/Whats-App-Image-2025-07-28-at-18-00-42.jpg" 
                         alt="Ambuj Kumar Tripathi" 
                         class="profile-square">
                    <div class="status-indicator">
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                
                <!-- Premium Typography -->
                <div class="space-y-4">
                    <h1 class="text-5xl lg:text-7xl title-premium premium-gradient">DataCraft Studio</h1>
                    <div class="space-y-2">
                        <p class="text-2xl lg:text-3xl subtitle-premium text-white/90">By <span class="text-red-500 font-bold">Ambuj Kumar Tripathi</span></p>
                        <div class="flex flex-wrap items-center justify-center gap-2 lg:gap-4 text-sm lg:text-base text-white/70">
                            <span class="code-font bg-white/10 px-3 py-1 rounded-full">AI Engineer</span>
                            <span class="code-font bg-white/10 px-3 py-1 rounded-full">Prompt Engineering</span>
                            <span class="code-font bg-white/10 px-3 py-1 rounded-full">Visualization Expert</span>
                            <span class="code-font bg-white/10 px-3 py-1 rounded-full">LLM & Chatbot Solutions</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Tool Container -->
        <div class="premium-glass rounded-3xl p-6 lg:p-12 w-full max-w-7xl relative overflow-hidden slide-up">
            
            <!-- Premium accent line -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-600 via-orange-500 to-green-500"></div>
            
            <div class="relative z-10">
                <div class="mb-12 text-center">
                    <h2 class="text-3xl lg:text-4xl title-premium text-white mb-6">Transform Your Data Into <span class="premium-gradient">Stunning Visualizations</span></h2>
                    <p class="text-xl text-white/80 subtitle-premium">Upload Excel or CSV files and create interactive charts instantly. Powered by advanced AI algorithms.</p>
                </div>
                
                <!-- Premium File Upload Section -->
                <div class="mb-12">
                    <div class="card-glass rounded-2xl p-8 lg:p-10 upload-premium">
                        <div class="flex flex-col items-center space-y-6">
                            <div class="w-20 h-20 bg-gradient-to-r from-red-600 to-orange-500 rounded-2xl flex items-center justify-center shadow-2xl">
                                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                            </div>
                            <div class="text-center space-y-3">
                                <h3 class="text-2xl title-premium text-white">Upload Your Dataset</h3>
                                <p class="text-white/70 subtitle-premium">Supports CSV and Excel files ‚Ä¢ Maximum 5MB ‚Ä¢ Instant processing</p>
                            </div>
                            <input type="file" id="fileInput" 
                                   class="file-input-premium w-full max-w-xs">
                            <div id="fileNameDisplay" class="mt-6 text-center"></div>
                        </div>
                    </div>
                </div>

                <!-- Premium Analysis Controls Section -->
                <div id="analysisSection" class="hidden mb-12 fade-in">
                    <div class="card-glass rounded-2xl p-8 lg:p-10">
                        <h3 class="text-3xl title-premium text-white mb-8 text-center">Configure Your <span class="premium-gradient">Visualization</span></h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
                            <!-- Primary Column -->
                            <div class="space-y-3">
                                <label for="column1" class="block text-sm font-semibold text-red-400 subtitle-premium">Primary Data Column</label>
                                <select id="column1" 
                                        class="premium-select w-full px-4 py-4 rounded-xl text-white focus:ring-2 focus:ring-red-500/20">
                                </select>
                            </div>
                            
                            <!-- Secondary Column -->
                            <div class="space-y-3">
                                <label for="column2" class="block text-sm font-semibold text-orange-400 subtitle-premium">Secondary Column (Optional)</label>
                                <select id="column2" 
                                        class="premium-select w-full px-4 py-4 rounded-xl text-white focus:ring-2 focus:ring-orange-500/20">
                                    <option value="">None Selected</option>
                                </select>
                            </div>
                            
                            <!-- Chart Type -->
                            <div class="space-y-3">
                                <label for="chartType" class="block text-sm font-semibold text-green-400 subtitle-premium">Visualization Type</label>
                                <select id="chartType" 
                                        class="premium-select w-full px-4 py-4 rounded-xl text-white focus:ring-2 focus:ring-green-500/20">
                                    <option value="bar">üìä Bar Chart</option>
                                    <option value="line">üìà Line Chart</option>
                                    <option value="scatter">üîç Scatter Plot</option>
                                    <option value="pie">ü•ß Pie Chart</option>
                                    <option value="histogram">üìä Histogram</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-8">
                            <button id="generateChartBtn" 
                                    class="premium-btn px-10 py-4 rounded-full text-lg title-premium shadow-2xl relative overflow-hidden">
                                <span id="generateBtnText">Generate Visualization</span>
                                <div id="generateBtnLoader" class="netflix-loader hidden ml-3"></div>
                            </button>
                            
                            <button id="downloadPdfBtn" 
                                    class="secondary-btn px-10 py-4 rounded-full text-lg title-premium shadow-2xl hidden">
                                üìÑ Download PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Premium Chart Display Area -->
                <div id="chartContainer" class="hidden fade-in">
                    <div class="chart-premium rounded-2xl p-6 lg:p-10">
                        <h3 class="text-3xl title-premium text-white mb-8 text-center">Your Data <span class="premium-gradient">Visualization</span></h3>
                        <div id="chart" class="w-full h-[500px] lg:h-[700px] rounded-xl overflow-hidden"></div>
                    </div>
                </div>

                <!-- Premium Status Messages -->
                <div id="statusMessage" class="mt-8 text-center text-lg subtitle-premium"></div>
            </div>
        </div>
        
        <!-- Premium Footer -->
        <footer class="mt-16 text-center space-y-6 fade-in">
            <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-10">
                <a href="https://www.linkedin.com/in/ambuj-tripathi-042b4a118/" target="_blank" 
                   class="group flex items-center space-x-3 bg-blue-600 hover:bg-blue-500 px-6 py-3 rounded-full transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-blue-600/25">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.338 16.338H13.67V12.16c0-.995-.017-2.277-1.387-2.277-1.39 0-1.601 1.086-1.601 2.207v4.248H8.014v-8.59h2.559v1.174h.037c.356-.675 1.227-1.387 2.526-1.387 2.703 0 3.203 1.778 3.203 4.092v4.711zM5.005 6.575a1.548 1.548 0 11-.003-3.096 1.548 1.548 0 01.003 3.096zm-1.337 9.763H6.34v-8.59H3.667v8.59zM17.668 1H2.328C1.595 1 1 1.581 1 2.298v15.403C1 18.418 1.595 19 2.328 19h15.34c.734 0 1.332-.582 1.332-1.299V2.298C19 1.581 18.402 1 17.668 1z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="title-premium">LinkedIn Profile</span>
                </a>
                <a href="https://ambuj123-lab.github.io/Ambuj_AI_Portfolio/" target="_blank" 
                   class="group flex items-center space-x-3 bg-purple-600 hover:bg-purple-500 px-6 py-3 rounded-full transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-600/25">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="title-premium">Portfolio</span>
                </a>
            </div>
            <div class="space-y-2">
                <p class="text-white/60 subtitle-premium">
                    Crafted with precision by <span class="premium-gradient title-premium font-bold">Ambuj Kumar Tripathi</span>
                </p>
                <p class="text-white/40 text-sm code-font">
                    Data Visualization ‚Ä¢ AI Engineering ‚Ä¢ Machine Learning
                </p>
            </div>
        </footer>
    </div>

    <script>
        let uploadedData = null;
        const MAX_FILE_SIZE_MB = 5;

        // Get DOM elements
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const analysisSection = document.getElementById('analysisSection');
        const chartContainer = document.getElementById('chartContainer');
        const statusMessage = document.getElementById('statusMessage');
        const column1Select = document.getElementById('column1');
        const column2Select = document.getElementById('column2');
        const chartTypeSelect = document.getElementById('chartType');
        const generateChartBtn = document.getElementById('generateChartBtn');
        const generateBtnText = document.getElementById('generateBtnText');
        const generateBtnLoader = document.getElementById('generateBtnLoader');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');

        // Enhanced status message display
        const showStatus = (message, type = 'info') => {
            statusMessage.textContent = message;
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-orange-400'
            };
            statusMessage.className = `mt-8 text-center text-lg subtitle-premium ${colors[type] || colors.info}`;
        };

        // Enhanced loading state
        const setLoadingState = (loading, btnText = 'Generate Visualization') => {
            if (loading) {
                generateBtnText.textContent = 'Processing...';
                generateBtnLoader.classList.remove('hidden');
                generateChartBtn.disabled = true;
                generateChartBtn.classList.add('opacity-75', 'cursor-not-allowed');
            } else {
                generateBtnText.textContent = btnText;
                generateBtnLoader.classList.add('hidden');
                generateChartBtn.disabled = false;
                generateChartBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        };

        const processFile = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const data = e.target.result;
                    const fileExtension = file.name.split('.').pop().toLowerCase();
                    let rows;
                    let columns;

                    if (fileExtension === 'csv') {
                        Papa.parse(data, {
                            header: true,
                            dynamicTyping: true,
                            skipEmptyLines: true,
                            complete: (result) => {
                                rows = result.data;
                                columns = result.meta.fields;
                                resolve({ data: rows, columns });
                            },
                            error: (err) => reject(err)
                        });
                    } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const sheetName = workbook.SheetNames[0];
                        const sheet = workbook.Sheets[sheetName];
                        rows = XLSX.utils.sheet_to_json(sheet);
                        if (rows.length > 0) {
                            columns = Object.keys(rows[0]);
                        } else {
                            columns = [];
                        }
                        resolve({ data: rows, columns });
                    } else {
                        reject(new Error('Unsupported file type. Please upload a CSV or Excel file.'));
                    }
                };
                reader.onerror = (err) => reject(err);
                reader.readAsBinaryString(file);
            });
        };

        // Enhanced file input handler
        fileInput.addEventListener('change', async () => {
            const file = fileInput.files[0];
            if (!file) {
                fileNameDisplay.textContent = '';
                analysisSection.classList.add('hidden');
                chartContainer.classList.add('hidden');
                downloadPdfBtn.classList.add('hidden');
                showStatus('');
                return;
            }

            fileNameDisplay.innerHTML = `
                <div class="flex items-center justify-center space-x-3 bg-green-500/10 border border-green-500/20 rounded-xl px-6 py-4">
                    <svg class="w-6 h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-green-400 subtitle-premium font-medium">${file.name}</span>
                    <span class="text-green-400/60 text-sm code-font">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                </div>
            `;
            
            if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) {
                showStatus(`‚ö†Ô∏è File size exceeds the ${MAX_FILE_SIZE_MB}MB limit. Please choose a smaller file.`, 'error');
                analysisSection.classList.add('hidden');
                chartContainer.classList.add('hidden');
                return;
            }

            showStatus('üîÑ Processing your data... Please wait', 'info');
            
            try {
                const { data, columns } = await processFile(file);
                
                uploadedData = data;
                populateDropdowns(columns);
                analysisSection.classList.remove('hidden');
                showStatus(`‚úÖ Success! Loaded ${data.length} rows and ${columns.length} columns. Ready for visualization.`, 'success');

            } catch (error) {
                console.error('File Read Error:', error);
                showStatus(`‚ùå Error processing file: ${error.message}`, 'error');
                analysisSection.classList.add('hidden');
                chartContainer.classList.add('hidden');
            }
        });

        const populateDropdowns = (columns) => {
            column1Select.innerHTML = '';
            column2Select.innerHTML = '<option value="">None Selected</option>';
            columns.forEach(col => {
                const option1 = document.createElement('option');
                option1.value = col;
                option1.textContent = col;
                column1Select.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = col;
                option2.textContent = col;
                column2Select.appendChild(option2);
            });
            chartTypeSelect.dispatchEvent(new Event('change'));
        };

        chartTypeSelect.addEventListener('change', () => {
            const selectedChart = chartTypeSelect.value;
            if (selectedChart === 'pie' || selectedChart === 'histogram') {
                column2Select.disabled = true;
                column2Select.value = '';
                column2Select.classList.add('opacity-50');
            } else {
                column2Select.disabled = false;
                column2Select.classList.remove('opacity-50');
            }
        });

        generateChartBtn.addEventListener('click', async () => {
            if (!uploadedData) {
                showStatus('‚ùå Please upload a file first.', 'error');
                return;
            }

            const column1 = column1Select.value;
            const column2 = column2Select.value;
            const chartType = chartTypeSelect.value;

            if (!column1) {
                showStatus('‚ùå Please select a primary column.', 'error');
                return;
            }
            
            setLoadingState(true);
            showStatus('üé® Creating your stunning visualization...', 'info');

            try {
                // Add small delay for better UX
                await new Promise(resolve => setTimeout(resolve, 1200));
                
                let chartData;
                let chartLayout;
                
                const xData = uploadedData.map(d => d[column1]);
                let yData = [];
                if (column2) {
                    yData = uploadedData.map(d => d[column2]);
                }

                const commonLayout = {
                    paper_bgcolor: 'rgba(0,0,0,0.9)',
                    plot_bgcolor: 'rgba(8,8,8,0.95)',
                    font: { color: '#ffffff', family: 'SF Pro Display, -apple-system, BlinkMacSystemFont, system-ui, sans-serif', size: 14 },
                    margin: { t: 80, r: 40, b: 80, l: 80 },
                    showlegend: true,
                    legend: { 
                        bgcolor: 'rgba(0,0,0,0.7)',
                        bordercolor: 'rgba(255,255,255,0.2)',
                        borderwidth: 1,
                        font: { size: 12 }
                    },
                    hoverlabel: {
                        bgcolor: 'rgba(0,0,0,0.8)',
                        bordercolor: '#e50914',
                        font: { color: 'white', family: 'SF Pro Display' }
                    }
                };

                if (chartType === 'bar') {
                    if (!column2) {
                        const counts = {};
                        xData.forEach(item => {
                            counts[item] = (counts[item] || 0) + 1;
                        });
                        chartData = [{
                            x: Object.keys(counts),
                            y: Object.values(counts),
                            type: 'bar',
                            marker: {
                                color: Object.keys(counts).map((_, i) => {
                                    const colors = ['#e50914', '#f40612', '#ff6b6b', '#ee5a52', '#ff9500', '#ffd23f'];
                                    return colors[i % colors.length];
                                }),
                                line: { color: 'rgba(255,255,255,0.3)', width: 1 },
                                opacity: 0.8
                            },
                            hovertemplate: '<b>%{x}</b><br>Count: %{y}<extra></extra>'
                        }];
                        chartLayout = {
                            ...commonLayout,
                            title: { 
                                text: `üìä ${column1} Distribution`, 
                                font: { size: 28, color: '#ffffff', family: 'SF Pro Display' },
                                x: 0.5
                            },
                            xaxis: { 
                                title: { text: column1, font: { size: 16 } }, 
                                gridcolor: 'rgba(255,255,255,0.1)',
                                tickfont: { size: 12 }
                            },
                            yaxis: { 
                                title: { text: 'Count', font: { size: 16 } }, 
                                gridcolor: 'rgba(255,255,255,0.1)',
                                tickfont: { size: 12 }
                            }
                        };
                    } else {
                        chartData = [{
                            x: xData,
                            y: yData,
                            type: 'bar',
                            marker: {
                                color: '#e50914',
                                line: { color: 'rgba(255,255,255,0.3)', width: 1 },
                                opacity: 0.8
                            },
                            hovertemplate: '<b>%{x}</b><br>%{y}<extra></extra>'
                        }];
                        chartLayout = {
                            ...commonLayout,
                            title: { 
                                text: `üìä ${column1} vs ${column2}`, 
                                font: { size: 28, color: '#ffffff', family: 'SF Pro Display' },
                                x: 0.5
                            },
                            xaxis: { 
                                title: { text: column1, font: { size: 16 } }, 
                                gridcolor: 'rgba(255,255,255,0.1)',
                                tickfont: { size: 12 }
                            },
                            yaxis: { 
                                title: { text: column2, font: { size: 16 } }, 
                                gridcolor: 'rgba(255,255,255,0.1)',
                                tickfont: { size: 12 }
                            }
                        };
                    }
                } else if (chartType === 'line') {
                    if (!column2) {
                        showStatus('‚ùå Line chart requires two columns.', 'error');
                        setLoadingState(false);
                        return;
                    }
                    chartData = [{
                        x: xData,
                        y: yData,
                        type: 'scatter',
                        mode: 'lines+markers',
                        line: { color: '#e50914', width: 4, shape: 'spline' },
                        marker: { 
                            color: '#ffffff', 
                            size: 8,
                            line: { color: '#e50914', width: 2 }
                        },
                        hovertemplate: '<b>%{x}</b><br>%{y}<extra></extra>'
                    }];
                    chartLayout = {
                        ...commonLayout,
                        title: { 
                            text: `üìà ${column1} vs ${column2}`, 
                            font: { size: 28, color: '#ffffff', family: 'SF Pro Display' },
                            x: 0.5
                        },
                        xaxis: { 
                            title: { text: column1, font: { size: 16 } }, 
                            gridcolor: 'rgba(255,255,255,0.1)',
                            tickfont: { size: 12 }
                        },
                        yaxis: { 
                            title: { text: column2, font: { size: 16 } }, 
                            gridcolor: 'rgba(255,255,255,0.1)',
                            tickfont: { size: 12 }
                        }
                    };
                } else if (chartType === 'scatter') {
                    if (!column2) {
                        showStatus('‚ùå Scatter plot requires two columns.', 'error');
                        setLoadingState(false);
                        return;
                    }
                    chartData = [{
                        x: xData,
                        y: yData,
                        type: 'scatter',
                        mode: 'markers',
                        marker: {
                            size: 12,
                            color: yData,
                            colorscale: [
                                [0, '#e50914'],
                                [0.5, '#ff9500'],
                                [1, '#1db954']
                            ],
                            showscale: true,
                            colorbar: {
                                title: { text: column2, font: { size: 14 } },
                                titleside: 'right'
                            },
                            line: { color: 'rgba(255,255,255,0.6)', width: 1 }
                        },
                        hovertemplate: '<b>%{x}</b><br>%{y}<extra></extra>'
                    }];
                    chartLayout = {
                        ...commonLayout,
                        title: { 
                            text: `üîç ${column1} vs ${column2}`, 
                            font: { size: 28, color: '#ffffff', family: 'SF Pro Display' },
                            x: 0.5
                        },
                        xaxis: { 
                            title: { text: column1, font: { size: 16 } }, 
                            gridcolor: 'rgba(255,255,255,0.1)',
                            tickfont: { size: 12 }
                        },
                        yaxis: { 
                            title: { text: column2, font: { size: 16 } }, 
                            gridcolor: 'rgba(255,255,255,0.1)',
                            tickfont: { size: 12 }
                        }
                    };
                } else if (chartType === 'pie') {
                    const counts = {};
                    xData.forEach(item => {
                        counts[item] = (counts[item] || 0) + 1;
                    });
                    const colors = ['#e50914', '#f40612', '#ff6b6b', '#ee5a52', '#ff9500', '#ffd23f', '#1db954', '#1ed760'];
                    chartData = [{
                        labels: Object.keys(counts),
                        values: Object.values(counts),
                        type: 'pie',
                        marker: { 
                            colors: Object.keys(counts).map((_, i) => colors[i % colors.length]),
                            line: { color: 'rgba(255,255,255,0.6)', width: 2 }
                        },
                        textinfo: 'label+percent',
                        textfont: { color: '#ffffff', size: 16, family: 'SF Pro Display' },
                        hovertemplate: '<b>%{label}</b><br>Count: %{value}<br>Percentage: %{percent}<extra></extra>'
                    }];
                    chartLayout = {
                        ...commonLayout,
                        title: { 
                            text: `ü•ß ${column1} Distribution`, 
                            font: { size: 28, color: '#ffffff', family: 'SF Pro Display' },
                            x: 0.5
                        }
                    };
                } else if (chartType === 'histogram') {
                    chartData = [{
                        x: xData,
                        type: 'histogram',
                        marker: {
                            color: '#e50914',
                            line: { color: 'rgba(255,255,255,0.3)', width: 1 },
                            opacity: 0.8
                        },
                        hovertemplate: '<b>Range:</b> %{x}<br><b>Count:</b> %{y}<extra></extra>'
                    }];
                    chartLayout = {
                        ...commonLayout,
                        title: { 
                            text: `üìä ${column1} Histogram`, 
                            font: { size: 28, color: '#ffffff', family: 'SF Pro Display' },
                            x: 0.5
                        },
                        xaxis: { 
                            title: { text: column1, font: { size: 16 } }, 
                            gridcolor: 'rgba(255,255,255,0.1)',
                            tickfont: { size: 12 }
                        },
                        yaxis: { 
                            title: { text: 'Frequency', font: { size: 16 } }, 
                            gridcolor: 'rgba(255,255,255,0.1)',
                            tickfont: { size: 12 }
                        }
                    };
                } else {
                    showStatus('‚ùå Invalid chart type selected.', 'error');
                    setLoadingState(false);
                    return;
                }

                // Enhanced Plotly configuration
                const config = {
                    responsive: true,
                    displayModeBar: true,
                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
                    displaylogo: false,
                    modeBarButtonsToAdd: [{
                        name: 'Download as PNG',
                        icon: {
                            width: 857.1,
                            height: 1000,
                            path: 'm214 629c0 13 11 23 24 23h381c13 0 24-10 24-23v-381c0-12-11-23-24-23h-381c-13 0-24 11-24 23v381z m119-381h238v119h-238v-119z m0 143h238v238h-238v-238z m-119-143h95v119h-95v-119z m0 143h95v238h-95v-238z'
                        },
                        click: function() {
                            Plotly.downloadImage('chart', {
                                format: 'png',
                                filename: `datacraft_${chartType}_${Date.now()}`,
                                height: 700,
                                width: 1200,
                                scale: 3
                            });
                        }
                    }],
                    toImageButtonOptions: {
                        format: 'png',
                        filename: `datacraft_${chartType}_${Date.now()}`,
                        height: 700,
                        width: 1200,
                        scale: 3
                    }
                };

                await Plotly.newPlot('chart', chartData, chartLayout, config);
                
                chartContainer.classList.remove('hidden');
                downloadPdfBtn.classList.remove('hidden');
                setLoadingState(false);
                showStatus('üéâ Visualization created successfully! You can now download it as PDF.', 'success');

            } catch (error) {
                console.error('Chart Error:', error);
                showStatus(`‚ùå Visualization failed: ${error.message}`, 'error');
                chartContainer.classList.add('hidden');
                setLoadingState(false);
            }
        });

        downloadPdfBtn.addEventListener('click', async () => {
            const chartDiv = document.getElementById('chart');
            if (chartDiv.hasChildNodes()) {
                showStatus('üìÑ Preparing your premium PDF...', 'info');
                downloadPdfBtn.disabled = true;
                downloadPdfBtn.innerHTML = `
                    <div class="flex items-center justify-center space-x-2">
                        <div class="netflix-loader"></div>
                        <span>Generating PDF...</span>
                    </div>
                `;
                
                try {
                    const canvas = await html2canvas(chartDiv, {
                        scale: 4,
                        backgroundColor: '#000000',
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('landscape', 'mm', 'a4');
                    
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    const newWidth = imgWidth * ratio * 0.85;
                    const newHeight = imgHeight * ratio * 0.85;
                    
                    const xOffset = (pdfWidth - newWidth) / 2;
                    const yOffset = (pdfHeight - newHeight) / 2;

                    // Add premium header
                    pdf.setFillColor(229, 9, 20);
                    pdf.rect(0, 0, pdfWidth, 25, 'F');
                    
                    pdf.setFontSize(24);
                    pdf.setTextColor(255, 255, 255);
                    pdf.text('DataCraft Studio', 20, 17);
                    
                    pdf.setFontSize(12);
                    pdf.setTextColor(200, 200, 200);
                    pdf.text('Premium Data Visualization by Ambuj Kumar Tripathi', 20, 35);
                    
                    // Add timestamp
                    const now = new Date();
                    pdf.setFontSize(10);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text(`Generated on: ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}`, pdfWidth - 80, 35);
                    
                    pdf.addImage(imgData, 'PNG', xOffset, yOffset + 15, newWidth, newHeight - 15);
                    
                    const filename = `DataCraft_Premium_${chartTypeSelect.value}_${new Date().toISOString().split('T')[0]}.pdf`;
                    pdf.save(filename);
                    
                    showStatus('‚úÖ Premium PDF downloaded successfully!', 'success');
                    
                } catch (error) {
                    console.error('PDF Download Error:', error);
                    showStatus(`‚ùå PDF download failed: ${error.message}`, 'error');
                } finally {
                    downloadPdfBtn.disabled = false;
                    downloadPdfBtn.innerHTML = 'üìÑ Download PDF';
                }
            } else {
                showStatus('‚ùå No visualization available to download.', 'error');
            }
        });

        // Premium entrance effects
        document.addEventListener('DOMContentLoaded', () => {
            // Add premium click effects
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (!this.disabled) {
                        const rect = this.getBoundingClientRect();
                        const ripple = document.createElement('div');
                        ripple.style.cssText = `
                            position: absolute;
                            border-radius: 50%;
                            background: rgba(255,255,255,0.4);
                            transform: scale(0);
                            animation: ripple 0.6s linear;
                            left: ${e.clientX - rect.left - 10}px;
                            top: ${e.clientY - rect.top - 10}px;
                            width: 20px;
                            height: 20px;
                            pointer-events: none;
                        `;
                        this.style.position = 'relative';
                        this.appendChild(ripple);
                        
                        setTimeout(() => {
                            ripple.remove();
                        }, 600);
                    }
                });
            });
            
            // Add CSS animation for ripple
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
            
            // Show premium welcome message
            showStatus('üöÄ Welcome to DataCraft Studio! Upload your dataset to create stunning visualizations.', 'info');
        });

    </script>

</body>
</html>